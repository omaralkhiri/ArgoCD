# **Argo CD – Credential Templates Documentation**

## **Overview**

When working with large organizations or multiple Git repositories, you often need to authenticate against several repositories that share the same credentials. Instead of repeating username, password, SSH key, or GitHub App authentication details for each individual repository, Argo CD provides a powerful feature called **Credential Templates**.

Credential Templates allow you to define authentication settings once and apply them automatically to any repository whose URL matches the template’s configured base URL. This simplifies configuration, reduces duplication, and prevents credential inconsistencies across repositories.

---

## **What Are Credential Templates?**

A **Credential Template** is very similar to a repository credential configuration but is applied globally to multiple repositories that share a common URL prefix.

Instead of registering each repository individually with authentication details, you define a template containing the shared credentials and an organization-level Git URL. Argo CD will automatically apply these credentials to any repositories that match the template’s base URL prefix.

### **When to Use Credential Templates**

Use a credential template if:

* You have multiple Git repositories under the same organization or domain.
* All repositories require the same authentication method.
* You want to avoid repeating username/password/SSH key in each repo registration.
* You want to manage credentials centrally.

### **Important Behavior**

A repository **must not** include its own credential information if it is intended to use a credential template.
If a repository is defined with its own credentials, Argo CD will **ignore** the credential template.

---

## **How Credential Templates Work**

Assume you have a GitHub organization:

```
https://github.com/my-org
```

You can create a credential template using:

```
https://github.com/my-org
```

as the **URL prefix**.

After this, any repository such as:

```
https://github.com/my-org/service-api
https://github.com/my-org/infrastructure
https://github.com/my-org/frontend
```

will automatically use the template credentials **as long as the repository is not explicitly configured with different credentials**.

---

## **Defining Credential Templates in Argo CD**

Credential templates can be defined using:

1. **Declarative approach (YAML Kubernetes Secret)**
2. **CLI (argocd repo-creds command)**
3. **Web UI**

Each option is described below.

---

## **1. Declarative Approach (Kubernetes Secret)**

Credential templates are defined as Kubernetes secrets in the Argo CD namespace.

### **Secret Requirements**

* `type: Opaque`
* Must contain the label:

```yaml
argocd.argoproj.io/secret-type: repo-creds
```

This label distinguishes it from a regular repository secret.

### **Example YAML: Credential Template**

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: github-org-creds
  namespace: argocd
  labels:
    argocd.argoproj.io/secret-type: repo-creds
stringData:
  url: https://github.com/my-org
  username: myuser
  password: mypassword
```

### **Notes**

* `url` must point to the **base URL** (organization or domain).
* You can use HTTPS credentials, SSH private keys, or GitHub App credentials.
* Argo CD will automatically apply these credentials to all matching repo URLs.

---

## **2. CLI Approach (argocd repo-creds add)**

Argo CD CLI offers an easy method to register credential templates.

### **Example: Using HTTPS Username/Password**

```bash
argocd repo-creds add https://github.com/my-org \
  --username myuser \
  --password mypassword
```

### **Example: Using SSH Key**

```bash
argocd repo-creds add git@github.com:my-org \
  --ssh-private-key-path ~/.ssh/id_rsa
```

### **Example: GitHub App Credentials**

```bash
argocd repo-creds add https://github.com/my-org \
  --github-app-id 12345 \
  --github-app-installation-id 67890 \
  --github-app-private-key-path app-private-key.pem
```

---

## **3. Web UI Approach**

Argo CD allows creating credential templates directly from the graphical interface.

### **Steps**

1. Open Argo CD UI.
2. Navigate to **Settings → Repositories**.
3. Click **Connect Repo using HTTPS/SSH**.
4. Fill in the URL and credentials.
5. Instead of clicking **Connect**, click:
   **Save as Credential Template**
6. The template will be automatically stored in the cluster as a Kubernetes secret.

---

## **Using Credential Templates in Applications**

After defining a credential template:

* You can reference any repository under the base URL in your Argo CD Applications.
* The repository **does NOT need** to be registered individually.
* If you **do** add the repo manually, you must omit credentials for the template to apply.

### **Example Application Source**

```yaml
spec:
  source:
    repoURL: https://github.com/my-org/frontend
    path: manifests
    targetRevision: main
```

If this URL matches the template prefix, Argo CD applies the credential template automatically.

---

## **Key Points to Remember**

* Credential templates reduce duplication of sensitive data.
* They apply only to repositories matching the template’s base URL.
* A repo configured with its own credentials overrides the template.
* Templates can be created via YAML, CLI, or the Web UI.
* They are stored as Kubernetes Secrets with the label:
  `argocd.argoproj.io/secret-type: repo-creds`.

---

## **Conclusion**

Credential templates in Argo CD provide a flexible and efficient way to manage authentication for multiple repositories within the same organization or Git server. By centralizing credentials, you simplify repository management, enhance security, and reduce configuration overhead when managing large-scale GitOps setups.